# 4장

## ad-hoc - 주먹구구식으로 하기

`fig-confinement-ad-hoc.go` 코드이다.

예제를 보면 data 에는 고루틴인 loopData 녀석을 통해서만 접근한다.
기억하지? 오직 handleData 라는 채널을 통해서만 이녀석에 접근한다.

- 통신을 통해서만 공유하라!

하지만 누구든 이 규약을 까먹으면 큰일나는 것임
그래서 `ad-hoc` 보다는 `lexical` 이 낫다.

## Lexical - 어휘적으로 말이되게 한다.

`fig-confinement-ownership.go` 코드이다.

위에서는 data 라는 슬라이스를 패키지 전역으로 만들었지만
이것은 고루틴 안에서만 생성한다.

chanOwner 라는 녀석 안에서만 접근 가능한 익명함수 고루틴만이 result 에 접근가능한 것이다.

- 이처럼 chanOwner 안에서만 클로져로서 접근, 쓰기가 가능하게 해두는 것이다.
- 그리고 내보낼때는 오직 읽기만 가능한 녀석으로서 내보내는 것이고

그걸 다시 consumer 가 쓰는 것이고.

## 드디어 제대로된 제한

`fig-confinement-structs.go` 코드이다.

일단은 바이트 버퍼인 buff 에 때려넣고 출력하는 것이다.

공유할 데이터는 data []byte 인데 애초에 딱딱 나눠서 부분만 전달해주기에
충돌날 이유가 없는 것이다. 서로 다른 일부분만을 전달하여 그 이상에 접근하는 것을 제한하는 방법!

## Confinement - 왜 제한을 두는가?

동시성 문제를 가능한 할 수 있는 제한 방법을 이용하여 사전 차단부터 해두는 것이다.

그렇게 하고도 남은 동시성 문제들만 다루자는 것이다.
